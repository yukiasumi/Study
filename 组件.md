![image-20220224101945897](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224101945897.png)

![image-20220224101747068](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224101747068.png)







![](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224101916768.png)





![image-20220224102605928](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224102605928.png)



![image-20220224102221712](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224102221712.png)

## 1.Zookeeper&Yarn

Zookeeper:是一个分布式协调服务(Coordination)，一个leader，多个 follower组成的集群，就是为用户的分布式应用程序提供协调服务。

Yarn:“一个集群多个框架”，即在一个集群上部署一个统一的资源调度管理框架YARN，在 YARN之上可以部署其他各种计算框架。由YARN为这些计算框架提供统一的资源调度管理服务，并且能够根据各种计算框架的负载需求，调整各自占用的资源，实现集群资源共享和资源弹性收缩。

Kafka:一个分布式的消息系统，作为用户来说，只须要把数据扔给kafka，在须要的时候直接读就能够了，很是方便。【一处生产处处消费】
Hadoop:提供海量数据的存储服务(HDFS），提供分析海量数据框架（MapReduce）及运行平台(Yarn)

Flink:一个框架和分布式处理引擎，用于对无界和有界数据流进行有状态的计算。

Hive: Hive就是把写的SQL语句，翻译成MapReduce 代码，然后在Hadoop上执行。



用一个场景来讲解这两个服务的作用和联系。
在一个分布式系统上。现在有个任务要办。我们要找这个系统做这个任务，就要通知yarn。打个比方，yarn 的 master node看看这个系统里有很多slave node，看看谁有空，谁有能力(cpu、内存、等）来干这个事。然后把任务分配给合适的slave node来办这个事。

这个时候系统面临一个危险。那就是在分布式系统中，failure成为常态。yarn master node【将军】管理着很多个node【士兵】，管理着它们哪一个出问题了。危险在于master自己坏了怎么办。

常见的分布式系统出问题的解决办法是我们总保持有一个standby 【副将】的，到需要的时候顶上。yarn里的Resource Manager也有待命的。当一个Resource Manager坏了,或者需要升级更新,另一个Resource Manager要接手。这时候麻烦来了，新的Resource Manager怎么知道哪个任务已经完成，哪个还没有，用户想执行的任务到什么状态了，一个任务所必须的先决条件任务是否已经完成。

新启动的Resource Manager成了这个分布式系统的备用大脑。两个大脑管理同一套资源，就可能有不一致的地方。

要解决这个问题，我们就要保存Yarn自身的各种状态，比如都收到了哪些任务，各个任务都执行到了什么状态，收到了哪些安全许可。这些东西保存在Resource Manager State Store【数据库】里。

Resource Manager State Store自己怎么管理呢。好几种办法，存在内存，存在文件，或者另外一个更容易的办法就是Zookeeper了。

Zookeeper控制着什么时候，谁可以读写这个Resource Manager State Store。Zookeeper 保存着它所管理的系统的各种状态，可以保证任何时候都只有一个版本的系统状态。即便是 Yarn的 Master坏了，重启了正在升级，也不会出现冲突。

<font size =5 color = FF0000>所以Yarn偏重于系统资源调度，Zookeeper对目前的系统中运行的任务进度或者状态进行监测。</font>

<font size =5 color = FF0000>Yarn调度资源</font>

<font size =5 color = FF0000>ZooKeeper检测状态</font>



## 2.Kafka【消息中间件】

一些大的网站若是想统计用户的访问状况，若是每一个用户的访问，都在后端通过一系列的用户行为分析，而后再给客户返回结果这显然不现实。这时候就须要一个消息系统，在用户一个请求过来后，服务器只须要把此次操做扔到后端，不用管后端的处理结果，直接返回给用户结果，这样用户体验才比较好，比较符合实际状况。

Kafka是一个分布式的消息订阅系统，做为用户【企业用户】来讲，只须要把数据扔给kafka，在需要的时候直接读就能够了，很是方便。

【数据暂停】



![image-20220224104000853](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224104000853.png)

<font size=5 color =FF0000>生产->存储->消费</font>



![image-20220224104113000](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224104113000.png)

![image-20220224104914054](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224104914054.png)

<font size=5 color = FF0000>Topic 唯一标识生产数据流【数据是干啥的，类似数据库的表有指定消费者，一个topic只能给一个groupID消费（防止抢占式消费）】</font>

<font size=5 color=FF000>Partition 分区【并发、多线程】</font>

<font size=5 color=FF000>Offset 偏移量【下标】</font>

![image-20220224105211095](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105211095.png)



## Offset有什么用?
消费者在消费数据时,发生宕机后,再次重新启动后,消费的数据需要从宕机位置开始读取如果从头读取,有一部分消息一定出现了重复消费
如果从宕机时的消费位置读取,就不会出现重复消费
因此 kafka设计了offset可以用于处理这种情况，目前支持8种策略。

![image-20220224105432596](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105432596.png)

![image-20220224105442093](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105442093.png)

![image-20220224105538493](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105538493.png)

![image-20220224105559919](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105559919.png)

![image-20220224105648284](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105648284.png)

![image-20220224105655333](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105655333.png)

![image-20220224105703284](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105703284.png)

![image-20220224105806062](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105806062.png)

![image-20220224105814471](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105814471.png)

![image-20220224105921351](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105921351.png)

![image-20220224105948926](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224105948926.png)

![image-20220224110010509](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224110010509.png)

![image-20220224110027256](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224110027256.png)

![image-20220224110039619](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224110039619.png)

![image-20220224110154350](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224110154350.png)

<font size=5 color=FF0000>offset=30 从第31个数据开始消费【不足31会等待第31个数据生成】</font>

![image-20220224110311603](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224110311603.png)

## Hadoop

![image-20220224112707175](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224112707175.png)

![image-20220224112749949](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224112749949.png)

![image-20220224112900166](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224112900166.png)

![image-20220224112939393](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224112939393.png)

![image-20220224113046941](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113046941.png)

![image-20220224113227172](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113227172.png)

![image-20220224113313765](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113313765.png)

![image-20220224113334604](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113334604.png)

![image-20220224113430230](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113430230.png)

![image-20220224113521002](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113521002.png)

![image-20220224113615370](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113615370.png)

![image-20220224113629502](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113629502.png)

![image-20220224113740723](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113740723.png)

![image-20220224113759799](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224113759799.png)

<font size=5 color = FF0000>hive适合处理静态数据，不适合处理动态数据</font>

![image-20220224114011103](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224114011103.png)

![image-20220224114133014](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224114133014.png)

<font size=5 color = FF0000>有界流：静态数据</font>

<font size=5 color = FF0000>无界流：动态数据</font>

![image-20220224114240084](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224114240084.png)

<font size=5 color = FF0000>有计算、无计算</font>

![image-20220224114415497](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224114415497.png)

![image-20220224114446631](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224114446631.png)

![image-20220224114608824](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224114608824.png)

![image-20220224114817760](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224114817760.png)

![image-20220224115134336](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224115134336.png)

![image-20220224115141711](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224115141711.png)

![image-20220224115341005](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224115341005.png)

<font size=5 color = FF0000>Hadoop分三大组件：HDFS分布式存储、MapReduce分布式计算、Yarn资源调度</font>

<font size=5 color = green>Kafka</font>

1. topic

2. group

3. producer

4. consumer

<font size=5 color = green>Hadoop</font>

<font size=5 color = green>Flink</font>

![image-20220224145039220](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224145039220.png)

![image-20220224145158919](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224145158919.png)

![image-20220224152356638](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224152356638.png)

<font size=5 color=FF0000>Flink运行时由两种类型的进程组成:至少一个JobManager和一个或者多个TaskManager</font>

2.jobManager:
1.主要职责是调度工作并协调任务做检查点;
⒉.集群中至少要有一个master，master负责调度task，协调checkpoints和容错;

3.高可用设置的话可以有多个master，但要保证一个是leader,其他是standby;4.Job Manager包含Actor System、Scheduler、CheckPoint三个重要的组件;
1.JobManager和TaskManager 之间通过Actor System进行通信
2.JobManager 会触发Checkpoint 操作，每个TaskManager节点收到Checkpoint触发指令后，完成Checkpoint操作，所有的 Checkpoint 协调过程都是在Fink JobManager中完成
5.JobManager从客户端接收到任务以后,首先生成优化过的执行计划,再调度到TaskManager中执行。3. taskManager:
1.主要职责是从JobManager处接收任务，并部署和启动任务,接收上游的数据并处理;2.Task Manager是在JVM中的一个或多个线程中执行任务的工作节点;
3.TaskManager在创建之初就设置好了Slot,每个Slot可以执行一个任务

![image-20220224153702900](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224153702900.png)

![image-20220224153721537](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224153721537.png)

![image-20220224153805029](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224153805029.png)

RT平台基础算子
1.kafkaSource:
	1.什么是topic

​	2.什么是group
​	3.什么是offset (latest、eaflist、force-latest、force-earlist)

2. kafkaSink

3. sourceFormat
4. sinkFormat
5. 连接线:数据类型和变换
6. rulemapper
7. watermark
8. window

![image-20220224153935946](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224153935946.png)

![image-20220224154336184](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224154336184.png)

![image-20220224154356080](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224154356080.png)

如果没有消费过（比如topic中有100条数据，没有被消费过)没有offset，earliest从头开始消费，latest从尾开始消费
* latest:从新job发布以后的第一条数据开始消费
* earliest:从第1条数据开始消费
* force-latest: = latest
* force-earliest: = earliest
如果已经消费过（比如一共100条数据，已经消费90条)有offset，latest=earlist-
* latest:从第90条开始消费
* earlist:从第90条开始消费
* force-latest:从新job发布以后的第1条数据开始消费
* force-earliest:从第1条数据开始消费
如果已经消费过（(比如一共100条数据全部已经消费）有offset，latest=earlist
* latest:从job发布以后第一条数据开始消费
* earlist: 从job发布以后第一条数据开始消费
* force-latest:从新job发布以后的第1条数据开始消费
* force-earliest:从第l条数据开始消费

<font size=5 color=FF0000>水位线【定时器(系统时间processing+periodic)】</font>

<font size=5 color=FF0000>tumbling窗口【翻转，仅存一个】紧挨</font>

<font size=5 color=FF0000>sliding窗口【滑动，会同时存在多个】</font>

![image-20220224172236593](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224172236593.png)

![image-20220224172737461](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224172737461.png)

![image-20220224173708187](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224173708187.png)

![image-20220224180633994](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180633994.png)



![image-20220224180712593](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180712593.png)

![image-20220224180742486](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180742486.png)

![image-20220224180800348](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180800348.png)

![image-20220224180820162](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180820162.png)

![image-20220224180839378](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180839378.png)

![image-20220224180858829](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180858829.png)

![image-20220224180910898](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180910898.png)

![image-20220224180926300](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180926300.png)

![image-20220224180934434](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180934434.png)

![image-20220224180955120](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224180955120.png)

监测↑

![image-20220224181024504](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181024504.png)

![image-20220224181047488](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181047488.png)

![image-20220224181057253](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181057253.png)

![image-20220224181106524](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181106524.png)

![image-20220224181144242](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181144242.png)

![image-20220224181159768](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181159768.png)

![image-20220224181224861](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181224861.png)

![image-20220224181234586](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181234586.png)

![image-20220224181320538](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181320538.png)

![image-20220224181349422](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181349422.png)

![image-20220224181406544](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181406544.png)

![image-20220224181433777](C:\Users\hakuou\AppData\Roaming\Typora\typora-user-images\image-20220224181433777.png)